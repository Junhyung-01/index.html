<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>포켓몬 검색기</title>
    <style>
      @font-face {
        font-family: "Simple";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2307-1@1.1/Danjo-bold-Regular.woff2") format("woff2");
        font-weight: normal;
        font-display: swap;
      }

      body {
        font-family: "Simple";
        margin: 0;
        padding: 2rem 0;
        background: linear-gradient(135deg, #fceabb, #f8b500);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      section {
        max-width: 400px;
        width: 100%;
      }

      /* 검색 폼 */
      #search-form {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
        background: #fff8e7;
        padding: 1rem;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      #search-form input {
        width: 80%;
        padding: 0.5rem;
        border: 2px solid #ccc;
        border-radius: 0.5rem;
        font-size: 1rem;
        outline: none;
      }

      #search-form input:focus {
        border-color: #f33;
        box-shadow: 0 0 5px #f33;
      }

      #search-form button {
        width: 80%;
        padding: 0.5rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        font-weight: bold;
        background: #ff4040;
        color: white;
        cursor: pointer;
        transition: 0.2s;
      }

      #search-form button:hover {
        background: #cc0000;
        transform: scale(1.05);
      }

      /* 결과 카드 */
      #container {
        margin-top: 2rem;
        text-align: center;
      }

      #message {
        font-size: 1.2rem;
        color: #444;
        margin-top: 1rem;
      }

      #poke-info {
        background: white;
        margin-top: 1rem;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.5s ease-in-out;
      }

      #poke-info strong {
        color: #333;
      }

      #poke-info img {
        margin-top: 1rem;
        width: 150px;
        height: 150px;
        object-fit: contain;
        border: 3px solid #eee;
        border-radius: 50%;
        background: #fafafa;
        box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.1);
      }

      .hide {
        display: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* 타입 뱃지 기본 스타일 */
      .type-badge {
        display: inline-block;
        margin: 0.25rem;
        padding: 0.25rem 0.6rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        font-weight: bold;
        color: white;
      }

      /* 진화 단계 뱃지 스타일 */
      .evo-badge {
        display: inline-block;
        margin: 0.2rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
        font-weight: bold;
        color: white;
        background: #777;
      }
    </style>
  </head>
  <body>
    <!-- 검색창 -->
    <section id="controller">
      <form id="search-form">
        <input
          type="text"
          name="poke-name"
          id="poke-name"
          placeholder="포켓몬 이름을 입력해주세요"
        />
        <button id="search-form-btn">🔍 검색</button>
      </form>
    </section>

    <!-- 결과창 -->
    <section id="container">
      <div id="message">검색해보세요!</div>
      <section class="hide" id="poke-info">
        <section>
          <div>
            <strong>도감번호</strong> : <span id="poke-id">#000</span>
          </div>
          <div>
            <strong>이름</strong> : <span id="poke-koname">포켓몬</span>
          </div>
          <div>
            <strong>영어</strong> : <span id="poke-enname">Pokemon</span>
          </div>
          <div>
            <strong>타입</strong> : <span id="poke-types">Normal</span>
          </div>
          <div>
            <strong>진화</strong> : <span id="poke-evolutions"></span>
          </div>
          <img src="" alt="포켓몬 사진" />
        </section>
      </section>
    </section>

    <script>
      const typeMap = {
        normal: "노말", fire: "불꽃", water: "물", electric: "전기", grass: "풀",
        ice: "얼음", fighting: "격투", poison: "독", ground: "땅", flying: "비행",
        psychic: "에스퍼", bug: "벌레", rock: "바위", ghost: "고스트", dragon: "드래곤",
        dark: "악", steel: "강철", fairy: "페어리",
      };

      const typeColors = {
        normal: "#A8A77A", fire: "#EE8130", water: "#6390F0", electric: "#F7D02C",
        grass: "#7AC74C", ice: "#96D9D6", fighting: "#C22E28", poison: "#A33EA1",
        ground: "#E2BF65", flying: "#A98FF3", psychic: "#F95587", bug: "#A6B91A",
        rock: "#B6A136", ghost: "#735797", dragon: "#6F35FC", dark: "#705746",
        steel: "#B7B7CE", fairy: "#D685AD",
      };

      // 한글 이름 -> ID 매핑
      async function changeNameToId(name) {
        if (localStorage.getItem("nameToId")) {
          return JSON.parse(localStorage.getItem("nameToId"))[name];
        }
        const pokeLength = 1025;
        const nameToId = {};
        async function fetchPokeKor(id) {
          const koNameResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`);
          if (!koNameResponse.ok) return;
          const koNameData = await koNameResponse.json();
          const { names } = koNameData;
          const koNames = names.filter(x => x.language.name === "ko");
          const koName = koNames[0].name;
          nameToId[koName] = id;
        }
        const promises = [];
        for (let i = 1; i < pokeLength; i++) promises.push(fetchPokeKor(i));
        await Promise.all(promises);
        localStorage.setItem("nameToId", JSON.stringify(nameToId));
        return nameToId[name];
      }

      // 영어 이름 -> ID
      async function changeNameToIdByEng(engName) {
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${engName}`);
        const data = await response.json();
        return data.id;
      }

      // ID -> 한국어 이름
      async function getKoreanName(pokeNo) {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokeNo}`);
        const data = await res.json();
        const koNames = data.names.filter(x => x.language.name === "ko");
        return koNames[0].name;
      }

      // 진화 체인 가져오기
      async function getEvolutions(pokeNo) {
        const speciesRes = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokeNo}`);
        const speciesData = await speciesRes.json();
        const evoChainUrl = speciesData.evolution_chain.url;
        const evoRes = await fetch(evoChainUrl);
        const evoData = await evoRes.json();

        const evoNames = [];
        function traverse(chain) {
          evoNames.push(chain.species.name);
          if (chain.evolves_to.length > 0)
            chain.evolves_to.forEach(traverse);
        }
        traverse(evoData.chain);
        return evoNames;
      }

      // 포켓몬 검색
      async function searchName(name) {
        const pokeNo = await changeNameToId(name);
        if (!pokeNo) throw new Error("존재하지 않는 포켓몬!");

        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokeNo}`);
        const data = await response.json();
        const { sprites, id, types } = data;
        const { front_default } = sprites;

        // 이미지 적용
        document.querySelector("#container img").src = front_default;

        // 도감번호
        document.querySelector("#poke-id").textContent = "#" + String(id).padStart(3, "0");

        // 한국어 이름
        const koNameResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${pokeNo}`);
        const koNameData = await koNameResponse.json();
        const koNames = koNameData.names.filter(x => x.language.name === "ko");
        const koName = koNames[0].name;

        document.querySelector("#poke-koname").textContent = koName;
        document.querySelector("#poke-enname").textContent = data.name;

        // 타입 표시
        const typeContainer = document.querySelector("#poke-types");
        typeContainer.innerHTML = "";
        types.forEach(t => {
          const span = document.createElement("span");
          span.classList.add("type-badge");
          span.textContent = typeMap[t.type.name] || t.type.name;
          span.style.background = typeColors[t.type.name] || "#777";
          typeContainer.appendChild(span);
        });

        // 진화 표시 (한글)
        const evolutions = await getEvolutions(pokeNo);
        const evoContainer = document.querySelector("#poke-evolutions");
        evoContainer.innerHTML = "";
        for (let evo of evolutions) {
          const evoId = await changeNameToIdByEng(evo);
          const koEvoName = await getKoreanName(evoId);
          const span = document.createElement("span");
          span.classList.add("evo-badge");
          span.textContent = koEvoName;
          evoContainer.appendChild(span);
        }

        document.querySelector("#poke-info").classList.remove("hide");
        document.querySelector("#message").classList.add("hide");
        localStorage.setItem("memory", name);
      }

      // 검색 이벤트
      document.querySelector("#search-form").addEventListener("submit", async e => {
        e.preventDefault();
        const name = document.querySelector("#poke-name").value;
        if (!name) return;
        await searchName(name);
      });

      // 페이지 로딩 시 이전 검색 복원
      document.addEventListener("DOMContentLoaded", async () => {
        const memory = localStorage.getItem("memory");
        if (memory) {
          await searchName(memory);
          document.querySelector("#poke-name").value = memory;
        }
      });
    </script>
  </body>
</html>
